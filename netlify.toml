[build]
  command = "npm run build"
  publish = ".next"

[[plugins]]
  package = "@netlify/plugin-nextjs"

[build.environment]
  NODE_VERSION = "20"
  NPM_FLAGS = "--legacy-peer-deps"

# Enable Netlify Blobs and configure functions
[functions]
  node_bundler = "esbuild"
  external_node_modules = ["sharp", "canvas", "@sparticuz/chromium", "puppeteer-core"]
  included_files = ["node_modules/@sparticuz/chromium/bin/*"]

# Increase function timeout and memory for PDF processing
[[functions]]
  path = "/.netlify/functions/*"
  node_bundler = "esbuild"

[functions.environment]
  AWS_LAMBDA_FUNCTION_TIMEOUT = "60"
