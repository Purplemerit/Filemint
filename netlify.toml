[build]
  command = "npm run build"
  publish = ".next"

[[plugins]]
  package = "@netlify/plugin-nextjs"

[build.environment]
  NODE_VERSION = "20"
  # Needed so @sparticuz/chromium knows it is running in a Lambda/serverless context
  AWS_LAMBDA_FUNCTION_NAME = "netlify-functions"

# Serverless function configuration (applies to Next.js API routes via plugin)
[functions]
  node_bundler      = "esbuild"
  # These heavy native modules must NOT be bundled â€” they are used as-is
  external_node_modules = [
    "sharp",
    "canvas",
    "mammoth",
    "jszip",
    "@sparticuz/chromium",
    "puppeteer-core"
  ]
  # Include the Chromium binary that @sparticuz/chromium needs at runtime
  included_files = [
    "node_modules/@sparticuz/chromium/bin/**"
  ]
